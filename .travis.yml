language: cpp
dist: xenial

# install dependencies
install:
  - gem install mdl
  - source .travis-deps.sh
  - gradle deps --console=plain

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
  - ls $BASE
  - echo $GRADLE_LOCATION
  - echo $OPTIX_LOCATION
  - echo $CUDA_LOCATION
  - echo $MDL_LOCATION
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $GRADLE_LOCATION
    - $OPTIX_LOCATION
    - $CUDA_LOCATION
    - $MDL_LOCATION

script:
  # clean
  - gradle clean --console=plain -Poptix_location=$OPTIX_LOCATION -Pcuda_location=$CUDA_LOCATION -Pmdl_location=$MDL_LOCATION
  # build
  - gradle assemble compileCu --console=plain -Poptix_location=$OPTIX_LOCATION -Pcuda_location=$CUDA_LOCATION -Pmdl_location=$MDL_LOCATION
  # lint
  - gradle lint --console=plain -Poptix_location=$OPTIX_LOCATION -Pcuda_location=$CUDA_LOCATION -Pmdl_location=$MDL_LOCATION
